---
title: "American Election 2016 in California"
author: "Duy Ha Ly"
date: "November 12, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8, fig.path='Figs/',
                      echo=FALSE, warning=FALSE, message=FALSE, options(scipen=999))
```

```{r echo = FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
library(ggthemes)
library(gridExtra)
library(dplyr)
library(plotly)
library(grid)
library(DT)
library(GGally)
library(psych)
```

##Introduction
Welcome to my data exploration! Through this report, we will have an better insight about 2016 Presidential Campaign Finance 2016. The raw data is collected from website: http://fec.gov/disclosurep/pnational.do

The content of my report is organized by following sections:

1. Univariate Plots Section: multiple plots for individual variables.

2. Univariate Analysis: commment about the univariate finding.

3. Bivariate Plots Section: multiple plots for the relation between two variables

4. Bivariate Analysis: commment about the bivariate finding.

5. Multivariate Plots Section: multiple plots for the relation between three and more variables.

6. Multivariate Analysis: commment about the multivariate finding.

7. Final Plots and Summary.

8. Reflection.

##Data structure
```{r echo = FALSE}
pf <- read.csv('P00000001-CA.csv')
pf$contbr_occupation[pf$contbr_occupation == "INFORMATION REQUESTED PER BEST EFFORTS"] <- "INFORMATION REQUESTED"
names(pf)
dim(pf)
str(pf)
pf_sample <- pf #using whole dataset
```

In summary, this dataset has more than 1 million observations. This is quite a big data that can help me to know about the financial contribution of voters in California area during American Election 2016. Each observation contains 19 variables with multiple ordered factors. There is only 1 numeric variable, the amount of contribution or "contb_receipt_amt".

##1. Univariate Plots Section
```{r echo = FALSE, warning= FALSE}
#making function for bar plotting
create_unibarplot <- function(data_nm,variable,fill = 'orange'){
    return(ggplot(data = data_nm, aes_string(x = variable))+
               geom_bar(fill = fill))
}
#sorted data from highest to lowest
create_unibarplot(pf_sample,'reorder(cand_nm,table(cand_nm)[cand_nm])') +
    coord_flip() +
    ggtitle('Number of financial contribution per candidate') +
    xlab('Name of candidate') + ylab('Count (Low -> High)')
```

In the horizontal bar chart above, it is not uniform distribution. Number of contribution mainly go to Hilary Clinton or Bernard Sanders in CA. How is the distribution of money from contributors ?

```{r echo = FALSE, message= FALSE, warning= FALSE}
#create function for histogram plotting
create_hisplot <- function(data_nm,variable,
                           fill = 'yellow',
                           color="black",
                           binwidth = 10){
    return(ggplot(data = data_nm, aes_string(x = variable)) +
               geom_histogram(fill = fill, color = color, binwidth = binwidth))
}
```

```{r echo = FALSE, warning= FALSE}
create_hisplot(pf_sample,'contb_receipt_amt','yellow','black',10) +
    xlab('Reported contributor amount') + ylab('Count')
summary(pf_sample$contb_receipt_amt)
```

There is 75% of contribution that is from 15 usd to 87.5 usd to their candidates. In order to have better observation, I plotted the money contribution in range between 15 to 100 usd.

```{r echo = FALSE, warning= FALSE}
create_hisplot(pf_sample,'contb_receipt_amt','yellow','black',5) +
    xlim(0,100) +
    xlab('Reported contributor amount') + ylab('Count') +
    ggtitle('Distribution of financial contribution from 15 to 100 usd')
```

The peak is 25 usd/contribution.
Through the summary of financial contribution, there are negative and positive money. The positive is the money to candidate fund and the negative is the money out of candidate fund. So, I seperate this variable into 2 subsets. By doing this, I will have better comparison to determine who win and lose in fund raising in this American Election 2016.

```{r echo = FALSE, warning=FALSE}
#get positive contribution
pfs_plus <- subset(pf_sample, pf_sample$contb_receipt_amt > 0)
#get negative contribution
pfs_minus <- subset(pf_sample, pf_sample$contb_receipt_amt < 0)
```

###1.1. Positive Contribution
Let's start with the positive subset. How is the contribution in this group ?

```{r echo = FALSE, warning=FALSE}
create_unibarplot(pfs_plus,'reorder(cand_nm,table(cand_nm)[cand_nm])') +
    theme(axis.text.x = element_text(angle = 90)) +
    ggtitle('Number of contribution per candidate') +
    coord_flip() +
    xlab('Name of candidate') + ylab('Number of contribution')

create_hisplot(pfs_plus,'contb_receipt_amt','yellow','black',0.05) +
    ggtitle('Money gain distribution') +
    xlab('Reported financial contribution') + ylab('count') +
    scale_x_log10()
summary(pfs_plus$contb_receipt_amt)
```

Top 5 candidates that get the largest contribution are Hilary Clinton, Bernard Sanders, Rafael "TED" Cruz, Donald Trump and Benjamin Carson respectively. However, Hilary Clinton and Bernard Sanders have large dominant positions. On the other hand, the money per contribution is very diversed and I have to use log10() function to display this distribution. The median is at 27 usd and 75% is from 15 to 130.5 usd. There are outliers with max at 10,800 usd.

###1.2. Negative Contribution
```{r echo = FALSE, warning=FALSE}
create_unibarplot(pfs_minus,'reorder(cand_nm,table(cand_nm)[cand_nm])') +
    theme(axis.text.x = element_text(angle = 90)) +
    ggtitle('Number of contribution per candidate') +
    coord_flip() +
    xlab('Name of candidate') + ylab('Number of contribution')

create_hisplot(pfs_minus,'-contb_receipt_amt','yellow','black',0.05) +
    ggtitle('Money gain distribution') +
    xlab('Reported financial contribution') + ylab('count') +
    scale_x_log10()
summary(pfs_minus$contb_receipt_amt)
```

In contrast group, top 5 candidates that get largest number of negative contribution are Hilary Clinton, Bernard Sanders, Rafael "TED" Cruz, Marco Rubio and Benjamin Carson. Except Donald Trump, the top 4 candidates have highest postive contribution and also have highest negative contribution during this American Election in CA. In study of money per contribution, the median is - 100 usd and 75% is from -38 to -500 usd. The minimum is at -10,500 usd.

##2. Univariate Analysis
###What is the structure of your dataset?
There are 1,040,672 observations in the dataset with 19 variables. Except 'contb_receipt_amt', other features are ordered by factor variables with many levels.

```{r echo= FALSE, message=FALSE, warning=FALSE}
str(pf)
```

###What is/are the main feature(s) of interest in your dataset ?
The main features in this dataset are contb_receipt_amt (CONTRIBUTION RECEIPT AMOUNT) and cand_nm (CANDIDATE NAME). I would like to know the financial support of each candidate in this AMERiCAN ELECTION 2016. My idea is that I can make a prediction about the financial contribution based on other features.

###What other features in the dataset do you think will help support your investigation into your feature(s) of interest?
Name of city, occupation, candidate name likely contribute to the financial support.

###Did you create any new variables from existing variables in the dataset?
Currently I do not make new variable for univariate analysis. I found that it is not necessary to find new variable while I only have 1 numeric variable (contb_receipt_amt) and the rest is catergory variables.

###Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?
I encountered with the positive and negative sign in financial contribution. Therefore, I created two dataset which contains only positive or negative support. It help me to have a good overview of money raising and losing for each candidate. I used log_10 tranformation to study about the financial support because its distribution is very skewed.

In positive support, contribution tends to give money at some fixed amount with a highest count around 50euro . So is negative support, the highest count is at 100 euro. 

##3. Bivariate Plots Section
Firstly, I extract information of some outliers from financial contribution.

###3.1. Top contributors
####3.1a. Positive contributor
```{r echo = FALSE, warning= FALSE}
max_support <- pf_sample[which.max(pf_sample$contb_receipt_amt),]
max_support[,c("cand_nm","contbr_nm","contbr_zip")]
```

Scott Walker is the one who received the biggest money from contributor Rick Mut with 10,800.

```{r echo = FALSE, warning= FALSE}
target <- pf_sample[which(pf_sample$contbr_nm == "MUTH, RICK" & 
                              pf_sample$contbr_zip == "90680"),]
target[,c("cand_nm","contbr_nm",
          "contbr_zip","contb_receipt_amt",
          "contb_receipt_dt","receipt_desc")]

sum(target$contb_receipt_amt)

#making function for bivariable bar plotting
create_bibarplot <- function(data_nm, variable1, variable2, 
                             fill = NA, stat = 'identity'){
    return(ggplot(data = data_nm, aes_string(x = variable1, 
                                             y = variable2, 
                                             fill = fill))+
               geom_bar(stat = stat))
}

create_bibarplot(target,'contb_receipt_dt','contb_receipt_amt','cand_nm') +
    ggtitle('Financial Support of RICK MUTH') +
    xlab('Date') + ylab('usd')
```

On 7-Jul, he contributed 10,800 usd. Later, he withrawed 8,100 usd then put in 2,700 usd again. After 4 month, he got back 2,700 usd. In final, he only contributed 2,700 usd to Scott Walker for this American Election.

####3.1b. Negative contributor
```{r echo = FALSE, warning= FALSE}
min_support <- pf_sample[which.min(pf_sample$contb_receipt_amt),]
min_support[,c("cand_nm","contbr_nm","contbr_zip")]
```

The maximum money loss is 10,500 usd. Bernard Sanders is the one who lost largest money from contributor Nicolette Beck.

```{r echo = FALSE, warning= FALSE}
target <- pf_sample[which(pf_sample$contbr_nm == "BECK, NICOLETTE" & 
                              pf_sample$contbr_zip == "941103415"),]
target[,c("cand_nm","contbr_nm",
          "contbr_zip","contb_receipt_amt",
          "contb_receipt_dt","receipt_desc")]

sum(target$contb_receipt_amt)

create_bibarplot(target,'contb_receipt_dt','contb_receipt_amt','cand_nm') +
    ggtitle('Financial Support of Nicolette Beck') +
    theme(axis.text.x = element_text(angle = 90)) +
    xlab('Date') + ylab('usd')
```

Morover, the interesting point is that this contributor did transaction to Bernard Sanders in multiple times. At last, the money for Bernard Sanders from this contributor is 1,700 usd in total.

###3.2. Financial Support vs other features of interest
Since I have 18 features ordered by factor variables and the number of factors in my interested variables are large. It would be wise to make additional selections for each variables.
```{r echo= FALSE, warning=FALSE}
str(pf_sample$cand_nm)
str(pf_sample$contbr_city)
str(pf_sample$contbr_occupation)
```

```{r echo = FALSE, warning=FALSE}
#function for bivariate point plotting
create_bipointplot <- function(data_nm,variable1, variable2, 
                               fill = NA, alpha = 1){
    return(ggplot(data = data_nm, aes_string(x = variable1, y = variable2)) +
               geom_point(alpha = alpha))
}

by_cand_nm_p <- pfs_plus %>%
    group_by(cand_nm) %>%
    summarise(Money = sum(contb_receipt_amt), Count = n()) %>%
    arrange(desc(Money))

#convert column to vector
p1 <- create_bipointplot(by_cand_nm_p,'Count','Money', NA, 0.5) +
    theme(axis.text.x = element_text(angle = 90)) +
    xlab('Number of contribution') + ylab('Money Gain (usd)') +
    ggtitle("Money Earn vs Number of contribution in CA") +
    geom_smooth(method = "lm") +
    xlim(0,60000) + ylim(0,10000000) #remove outliers

by_cand_nm_m <- pfs_minus %>%
    group_by(cand_nm) %>%
    summarise(Money = sum(contb_receipt_amt),Count = n()) %>%
    arrange(Money)
by_cand_nm_m[1:5,"cand_nm"]

p2 <- create_bipointplot(by_cand_nm_m,'Count','Money', NA, 0.5) +
    theme(axis.text.x = element_text(angle = 90)) +
    xlab('Number of contribution') + ylab('Money Loss (usd)') +
    ggtitle("Money Loss vs Number of contribution in CA") +
    geom_smooth(method = "lm") +
    xlim(0,100) + ylim(-200000,0) #remove outliers

grid.arrange(p1,p2,ncol = 1)
```

In money gain:
```{r echo = FALSE, warning= FALSE}
lm(formula = Money~Count, data = by_cand_nm_p)
cor.test(by_cand_nm_p$Money,by_cand_nm_p$Count)
summary(by_cand_nm_p$Money)
```

In money loss:
```{r echo = FALSE, warning= FALSE}
lm(formula = Money~Count, data = by_cand_nm_m)
cor.test(by_cand_nm_m$Money,by_cand_nm_m$Count)
summary(by_cand_nm_m$Money)
```

As number of contributions increases, the amount of money increases. This phenomenan happens in both money gain and money loss. The relationship between contributions and money apprers to be linear.

Next, I observe the financial contribution and amount of money related to cities in LA.
```{r echo = FALSE, warning= FALSE}
by_cities_p <- pfs_plus %>%
  group_by(contbr_city) %>%
  summarise(Money = sum(contb_receipt_amt), Count = n()) %>%
  arrange(desc(Money))

#convert column of dataframe to vector
p1 <- create_bipointplot(by_cities_p,'Count','Money', NA, 0.1) +
    ggtitle("Contribution and Finance of CA cities") +
    xlab('Number of contribution') + ylab('Money Earn (usd)') +
    geom_smooth(method = "lm") +
    xlim(0,6000) + ylim(0,500000) #remove outliers

by_cities_m <- pfs_minus %>%
  group_by(contbr_city) %>%
  summarise(Money = sum(contb_receipt_amt), Count = n()) %>%
  arrange(Money)

p2 <- create_bipointplot(by_cities_m,'Count','Money', NA, 0.1) +
    ggtitle("Contribution and Finance of CA cities") +
    xlab('Number of contribution') + ylab('Money Loss (usd)') +
    geom_smooth(method = "lm") +
    xlim(0,200) + ylim(-150000,0) #remove outliers

grid.arrange(p1,p2,ncol = 1)
```

In money gain:
```{r echo = FALSE, warning= FALSE}
lm(formula = Money~Count, data = by_cities_p)
cor.test(by_cities_p$Money,by_cities_p$Count)
summary(by_cities_p$Money)
```

In money loss:
```{r echo = FALSE, warning= FALSE}
lm(formula = Money~Count, data = by_cities_m)
cor.test(by_cities_m$Money,by_cities_m$Count)
summary(by_cities_m$Money)
```

I have a high correlation between number of contribution and money gain per city. The city which has high number of contribution likely has high financial support for the election. Moreover, 75% of cities have contributed from 230 usd to 1827 usd (the median = 1827, the max = 14 millions).
On the other side, money loss is larger when the number of contribution increases. There is 75% of cities which have money loss from 7,000 usd to 10,000 usd (the median = 1926 usd and the max = ~700,000 usd)

```{r echo = FALSE, warning= FALSE}
by_occupation_p <- pfs_plus %>%
  group_by(contbr_occupation) %>%
  summarise(Money = sum(contb_receipt_amt), Count = n()) %>%
  arrange(desc(Money))

#convert column of dataframe to vector

p1 <- create_bipointplot(by_occupation_p,'Count','Money', NA, 0.05) +
    ggtitle("Contribution and Finance of CA jobs") +
    xlab('Number of contribution') + ylab('Money Earn (usd)') +
    geom_smooth() +
    xlim(0,500) + ylim(0,200000) #remove outliers

by_occupation_m <- pfs_minus %>%
  group_by(contbr_occupation) %>%
  summarise(Money = sum(contb_receipt_amt), Count = n()) %>%
  arrange(Money)

p2 <- create_bipointplot(by_occupation_m,'Count','Money', NA, 0.1) +
    ggtitle("Contribution and Finance of CA jobs") +
    xlab('Number of contribution') + ylab('Money Loss (usd)') +
    geom_smooth() +
    xlim(0,50) + ylim(-50000,0) #remove outliers

grid.arrange(p1,p2,ncol = 1)
```

In money gain:
```{r echo = FALSE, warning= FALSE}
lm(formula = Money~Count, data = by_occupation_p)
cor.test(by_occupation_p$Money,by_occupation_p$Count)
summary(by_occupation_p$Money)
```

In money loss:
```{r echo = FALSE, warning= FALSE}
lm(formula = Money~Count, data = by_occupation_m)
cor.test(by_occupation_m$Money,by_occupation_m$Count)
summary(by_occupation_m$Money)
```

It states that the amount of money highly related to the number of contribution per job (the median = 315 usd and the max = 20 millions usd ). This pattern appears in the negative support too (the median = 1290 usd and the max = 3.7 millions).

For extra bivariate plots, I explored the financial support of contributors in two subsets that have those features:

- In top 5 candidate. 

- In top 10 cities. 

- In top 20 occupation.

```{r echo = FALSE, message= FALSE, warning= FALSE}
#positive money
top_cities_nm_p <- as.vector(by_cities_p$contbr_city[1:10])
top_cand_nm_p <- as.vector(by_cand_nm_p$cand_nm[1:5])
top_job_nm_p <- as.vector(by_occupation_p$contbr_occupation[1:20])

#negative money
top_cities_nm_m <- as.vector(by_cities_m$contbr_city[1:10])
top_cand_nm_m <- as.vector(by_cand_nm_m$cand_nm[1:5])
top_job_nm_m <- as.vector(by_occupation_m$contbr_occupation[1:20])
```


###3.3. Extra exploration: Positive Contribution
```{r echo = FALSE, wanrning = FALSE}
target_pf <- pfs_plus %>%
    filter(contbr_city %in% top_cities_nm_p) %>%
    filter(cand_nm %in% top_cand_nm_p) %>%
    filter(contbr_occupation %in% top_job_nm_p) %>%
    select(candidate_name = cand_nm,city = contbr_city,amount_usd = contb_receipt_amt,occupation = contbr_occupation)
```

I started exploring subdata with positive contribution since it is the most important one.

```{r echo = FALSE, warning= FALSE}
dim(target_pf)
datatable(target_pf)
```

My data have 123,077 observatations with 4 selective variables.
I want to look closer at box plots involving financial support and other variables. By limiting the y axis, the boxplot observation is better. Let start with candidate:

####3.3a Financial Support vs Candidate Name
```{r echo = FALSE, warning= FALSE}
create_bibarplot_2 <- function(data_nm, variable1, variable2, stat = "identity",
                               fill = "orange", color = "black"){
    return(ggplot(data = data_nm, aes_string(x = variable1, y = variable2)) +
               geom_bar(stat = stat, fill = fill, color = color))
                               }

create_bibarplot_2(by_cand_nm_p[1:5,], "cand_nm", "Money") +
    xlab("Candidate name") + ylab (" Total Money gain (usd)") +
    coord_flip() +
    theme(axis.text.x = element_text(angle = 90))
```

```{r echo= FALSE, warning= FALSE}
target_pf$candidate_name <- factor(target_pf$candidate_name)

create_biboxplot <- function(data_nm, variable1, variable2, 
                             outlier.shape = NA, fill = "orange", 
                             color = "black"){
    return(ggplot(data = data_nm,aes_string(x = variable1, y = variable2)) +
               geom_boxplot(outlier.shape = outlier.shape, fill = fill, 
                            color = color))
    }

create_biboxplot(target_pf, "candidate_name", "amount_usd") +
    coord_cartesian(ylim = c(0,2000)) +
    ggtitle('Overview of financial support from contribution') +
    xlab('Candidate name') + ylab('Money Earn (usd)') +
    theme(axis.text.x = element_text(angle = 90))
by(target_pf$amount_usd, target_pf$candidate_name, summary)
```

All of 5 candidates have non-normal distribution of financial supports. Therefore, using median value is better choice than using mean value. Marco Rubio has biggest median of positive support (median = 100) and Bernard Sanders has smallest one (median = 27).

####3.3b. Financial Support vs Location
```{r echo = FALSE, message= FALSE, warning= FALSE}
create_bibarplot_2(by_cities_p[1:10,], "contbr_city", "Money", , "darkgreen") +
    theme(axis.text.x = element_text(angle = 90)) +
    xlab("City") + ylab("Total Money Gain (usd)") +
    coord_flip()
```

```{r echo= FALSE, warning= FALSE}
target_pf$city <- factor(target_pf$city)

create_biboxplot(target_pf, "city", "amount_usd", ,"darkgreen") +
    coord_cartesian(ylim = c(0,1000)) +
    ggtitle('Overview of financial support from city') +
    xlab('City') + ylab('Money Earn (usd)') +
    theme(axis.text.x = element_text(angle = 90))

by(target_pf$amount_usd, target_pf$city, 
   summary, digits = max(getOption('digits')))
```

Most contributions (75%) from top 10 cities are varied from 18 to 100 usd. Beverly Hills is the city which has hightest median of contribution. Sacramento and San Jose are the least one.

####3.3c Financial Support vs Occupation

```{r echo = FALSE, message= FALSE, warning= FALSE}
create_bibarplot_2(by_occupation_p[1:20,], "contbr_occupation", "Money", , 
                   "lightblue", "black") +
    theme(axis.text.x = element_text(angle = 90)) +
    xlab("City") + ylab("Total Money Gain (usd)") +
    coord_flip()
```

```{r echo= FALSE, warning= FALSE}
target_pf$occupation <- factor(target_pf$occupation)

create_biboxplot(target_pf, "occupation", "amount_usd", ,"lightblue") +
    coord_cartesian(ylim = c(0,3000)) +
    ggtitle('Overview of financial support from occupation') +
    xlab('Occupation') + ylab('Money Earn (usd)') +
    theme(axis.text.x = element_text(angle = 90))

by(target_pf$amount_usd, target_pf$occupation, 
   summary, digits = max(getOption('digits')))
```

In next catergory, the most contribution to American Election is from retire people with have more than 20 millions usd (median = 28.445 and the = 8800)

####3.3d. Cross Correlation between features of interest

```{r echo = FALSE, warning= FALSE}
pairs.panels(target_pf)
```

In general, the correlation between my interested variables are very low. The contribution is very diversed in city, occupation, employer and money to candidates.

###3.4. Extra exploration: Negative contribution
```{r echo = FALSE, wanrning = FALSE}
target_pf_nega <- pfs_minus %>%
    filter(contbr_city %in% top_cities_nm_m) %>%
    filter(cand_nm %in% top_cand_nm_m) %>%
    filter(contbr_occupation %in% top_job_nm_m) %>%
    select(candidate_name = cand_nm, city = contbr_city, 
           amount_usd = contb_receipt_amt, occupation = contbr_occupation)
```

```{r echo = FALSE, warning= FALSE}
dim(target_pf_nega)
datatable(target_pf_nega)
```

####3.4a. Financial Support vs Candidate Name

There are only 330 observations that satify my criteria.
```{r echo = FALSE, warning = FALSE, message = FALSE}

create_bibarplot_2(by_cand_nm_m[1:5,], "cand_nm", "Money", , "gray", "orange") +
    xlab("Candidate name") + ylab (" Total Money Loss (usd)") +
    coord_flip() +
    theme(axis.text.x = element_text(angle = 90))
```

```{r echo= FALSE, warning= FALSE}
target_pf_nega$candidate_name <- factor(target_pf_nega$candidate_name)

create_biboxplot(target_pf_nega, "candidate_name", "amount_usd", ,"gray", "orange") +
    #coord_cartesian(ylim = c(0,2000)) +
    ggtitle('Overview of losing money from contribution') +
    xlab('Candidate name') + ylab('Money Loss (usd)') +
    coord_cartesian(ylim = c(-3000,0)) +
    theme(axis.text.x = element_text(angle = 90))
by(target_pf$amount_usd, target_pf$candidate_name, summary)
```

Rubio has the largest range of losing money -500 to -2700 usd. Donal Trump has the shortest range of losing money.

####3.4b. Financial Support vs Location
```{r echo = FALSE, message= FALSE, warning= FALSE}
create_bibarplot_2(by_cities_m[1:10,], "contbr_city", "Money", , "gray", "darkgreen") +
    theme(axis.text.x = element_text(angle = 90)) +
    xlab("City") + ylab("Total Money Loss (usd)") +
    coord_flip()
```

```{r echo= FALSE, warning= FALSE}
target_pf_nega$city <- factor(target_pf_nega$city)

create_biboxplot(target_pf_nega, "city", "amount_usd", ,"gray","darkgreen") +
    coord_cartesian(ylim = c(-4000,0)) +
    ggtitle('Overview of losing money from city') +
    xlab('City') + ylab('Money Loss (usd)') +
    theme(axis.text.x = element_text(angle = 90))

by(target_pf_nega$amount_usd,target_pf_nega$city,summary,digits = max(getOption('digits')))
```

The city that have most money loss is Los Angeles with 700,000 usd (the median = -750, the max = -5,400)

####3.4c. Financial Support vs Occupation

```{r echo = FALSE, message= FALSE, warning= FALSE}
create_bibarplot_2(by_occupation_m[1:20,], "contbr_occupation", "Money", , 
                   "gray", "lightblue") +
    theme(axis.text.x = element_text(angle = 90)) +
    xlab("Occupation") + ylab("Total Money Loss (usd)") +
    coord_flip()
```

```{r echo= FALSE, warning= FALSE}
target_pf_nega$occupation <- factor(target_pf_nega$occupation)

create_biboxplot(target_pf_nega, "occupation", "amount_usd", , "gray","lightblue") +
    #coord_cartesian(ylim = c(0,3000)) +
    ggtitle('Overview of financial support from occupation') +
    xlab('Occupation') + ylab('Money Loss (usd)') +
    coord_cartesian(ylim = c(-3000,0)) +
    theme(axis.text.x = element_text(angle = 90))

#ggplot(data = target_pf_nega, aes(x = target_pf_nega$occupation, y = target_pf_nega$amount_usd)) +
#  geom_boxplot(outlier.shape = NA, fill = "gray", color = "lightblue") +
  #coord_cartesian(ylim = c(0,3000)) +
#  ggtitle('Overview of financial support from city') +
#  xlab('City') + ylab('Money Loss (usd)') +
#  theme(axis.text.x = element_text(angle = 90))

by(target_pf_nega$amount_usd,target_pf_nega$occupation,summary,digits = max(getOption('digits')))
```

The financial support is mostly reduced from people who has unknow occupation (median = 100, max = -10,500)

####3.4d. Cross Correlation between features of interest

```{r echo = FALSE, message = FALSE, warning= FALSE}
pairs.panels(target_pf_nega)
```

Similar to postive support exploration, I have very low correlation between features of interest.

##4. Bivariate Analysis
###Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

There is a high correlation between the number of contribution and the amount of money. Hence, a candidate needs to focus on gaining more contribution if he(she) want to increase his(her) election finance. In contrast, there is a risk of losing money when the number of contribution is also correlated to the amount of money loss. This pattern applies to candidate, cities and occupations.

Hilary Clinton is the one who earned biggest money in CA comparing to other candidates with ~ 80 millions and Marco Rubio is the one who lost biggest money in CA with ~ 1,5 millions.

In location, the financial support also depends on the size of city. It is clearly that the two biggest cities in CA have the highest amount of money for this American Election.

In occupation, the interesting point is that retire people contribute much money for American Election 2016. The variance of other features of interest hardly used to predict the financial contribution.

###Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?
There is no relationship between other features. It strongly depends on the trust of contributors during the election.

###What was the strongest relationship you found?
The strongest relationship that can be found in my exploration is that the magnitude of financial support is strongly correlated with the number of contribution. It doesnot correlated with the social status or location of contributors.

##5. Multivariate Plots Section

I applied the same approach as Extra Exploration by create two subset from raw data with following criteria:

- In top 5 candidate. 

- In top 10 cities. 

- In top 20 occupation.

###5.1. Positive Contribution

####5.1a. Location
```{r echo = FALSE, warning= FALSE}
#Making fraction plot between number of contribution, candidates and cities
ggplot(target_pf, aes(x = city, fill = candidate_name)) + 
    geom_bar(position = "fill") +
    coord_flip() +
    theme(axis.text.x = element_text(angle = 90)) +
    ggtitle("Contribution vs top candidates vs top cities") +
    #scale_color_discrete(name ="Candidate Name") +
    xlab("City") + ylab("Fraction")
```

```{r echo = FALSE, warning= FALSE}
by_name_city <- target_pf %>%
    group_by(candidate_name,city) %>%
    summarise(Money = sum(amount_usd)) %>%
    arrange(desc(Money))
```

```{r echo = FALSE, warning= FALSE}
ggplot(by_name_city, aes(x = city, y = Money, color = candidate_name)) +
    geom_point(size = 3) +
    coord_flip() +
    theme(axis.text.x = element_text(angle = 90)) +
    ggtitle("Total money gain vs top candidates vs top cities") +
    scale_color_discrete(name ="Candidate Name") +
    xlab("City") + ylab("Money Earn (usd)")
```

Hilary Clinton received more than 50% of support from 9 of 10 cities except Berkeley. People of Berkerly prefer Bernard Sanders. 


####5.1b. Occupation
Let take a look to the faction distribution for each candidate in top 20 jobs.

```{r echo = FALSE, warning= FALSE}
ggplot(target_pf, aes(x = occupation, fill = candidate_name)) + 
    geom_bar(position = "fill") +
    coord_flip() +
    theme(axis.text.x = element_text(angle = 90)) +
    ggtitle("Contribution vs top candidates vs top occupations") +
    scale_color_discrete(name ="Candidate Name") +
    xlab("Occupation") + ylab("Fraction")
```

```{r echo = FALSE, warning= FALSE}
by_name_job <- target_pf %>%
    group_by(candidate_name,occupation) %>%
    summarise(Money = sum(amount_usd)) %>%
    arrange(desc(Money))
```

```{r echo = FALSE, warning= FALSE}
ggplot(by_name_job, aes(x = occupation, y = Money, color = candidate_name)) +
    geom_point(size = 3) +
    coord_flip() +
    theme(axis.text.x = element_text(angle = 90)) +
    ggtitle("Total money gain vs top cities vs top occupations") +
    scale_color_discrete(name ="Candidate Name") +
    xlab("Occupation") + ylab("Money Earn (usd)")
```

17 of 20 occupation have more than 50% of financial support to Hilary Clinton. Only NOT EMPLOYED and SOFTWARE ENGINEER have more than 50% of their support to Bernard Sanders. Top 1 contributor, retire people also voted for Hilary Clinton.

```{r echo = FALSE, warning= FALSE}
by_city_job_p <- target_pf %>%
    group_by(city,occupation) %>%
    summarise(Money = sum(amount_usd), Count= n()) %>%
    arrange(desc(Money))
```

```{r echo = FALSE, warning= FALSE}
ggplot(by_city_job_p, aes(x = occupation, y = Count, color = city)) +
    geom_point(size = 3) +
    #geom_jitter(width = 1, height = 1) +
    coord_flip() +
    theme(axis.text.x = element_text(angle = 90)) +
    ggtitle("Total contribution vs top candidates vs top occupations") +
    xlab("Occupation")
```

The graph above shows the number of contribution of each occupation in each cities. In all of occupation, Los Angeles is the city which has biggest number of contribution from retire people. The second place is from retire people in San Francisco.

###5.2. Negative Contribution

####5.2a. Location
```{r echo = FALSE, warning= FALSE}
#Making fraction plot between number of contribution, candidates and cities
ggplot(target_pf_nega, aes(x = city, fill = candidate_name)) + geom_bar(position = "fill") +
    theme(axis.text.x = element_text(angle = 90)) +
    coord_flip() +
    ggtitle("Contribution vs top candidates vs top cities") +
    scale_color_discrete(name ="Candidate Name") +
    xlab("City") + ylab("Fraction")
```

```{r echo = FALSE, warning= FALSE}
by_name_city_m <- target_pf_nega %>%
    group_by(candidate_name,city) %>%
    summarise(Money = sum(amount_usd)) %>%
    arrange(desc(Money))
```

```{r echo = FALSE, warning= FALSE}
ggplot(by_name_city_m, aes(x = city, y = Money, color = candidate_name)) +
    geom_point(size = 3) +
    coord_flip() +
    theme(axis.text.x = element_text(angle = 90)) +
    ggtitle("Total money loss vs top candidates vs top cities") +
    scale_color_discrete(name ="Candidate Name") +
    xlab("City") + ylab("Money Loss (usd)")
```

Hilary Clinton (top 1 in positive contribution) received more than 50% of negative contribution in Oakland and San Francisco. Moreover, Marco Rubio is the one who lost biggest money in two largest cities: Los Angeles and San Francisco (6000 usd and 2000 usd respectively).

####5.2b. Occupation
```{r echo = FALSE, warning= FALSE}
ggplot(target_pf_nega, aes(x = occupation, fill = candidate_name)) + geom_bar(position = "fill") +
    coord_flip() +
    theme(axis.text.x = element_text(angle = 90)) +
    ggtitle("Contribution vs top candidates vs top occupations") +
    scale_color_discrete(name ="Candidate Name") +
    xlab("Occupation") + ylab("Fraction")
```

```{r echo = FALSE, warning= FALSE}
by_name_job_m <- target_pf_nega %>%
    group_by(candidate_name,occupation) %>%
    summarise(Money = sum(amount_usd)) %>%
    arrange(desc(Money))
```

```{r echo = FALSE}
ggplot(by_name_job_m, aes(x = occupation, y = Money, color = candidate_name)) +
    geom_point(size = 3) +
    coord_flip() +
    theme(axis.text.x = element_text(angle = 90)) +
    ggtitle("Total money loss vs top candidates vs top occupations") +
    scale_color_discrete(name ="Candidate Name") +
    xlab("Occupation") + ylab("Money Loss (usd)")
```

Obviously, Marco Rubio is the one who received the most number of negative contribution from top 20 opccupations. In group of unknow occupation, Hilary Clinton lost biggest money with ~ 400,000 usd.

```{r echo = FALSE, warning= FALSE}
by_city_job_m <- target_pf_nega %>%
    group_by(city,occupation) %>%
    summarise(Money = sum(amount_usd), Count= n()) %>%
    arrange(desc(Money))
```

```{r echo = FALSE, warning= FALSE}
ggplot(by_city_job_m, aes(x = occupation, y = Count, color = city)) +
    geom_point(size = 3) +
    #geom_jitter(width = 1, height = 1) +
    coord_flip() +
    theme(axis.text.x = element_text(angle = 90)) +
    ggtitle("Total contribution vs top cities vs top occupations") +
    xlab("Occupation")
```

In all of occupation, Los Angeles is the city which has biggest number of negative contribution from unknown people. The second place is from unknown people in San Francisco.

##6. Multivariate Analysis

####Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

The relationship in this part stated that the candidate who has large number of contribution, will have large financial support (ex: Hilary Clinton). This principle applied to other feature like location (cities) and social status (occupation).

Hilary Clinton won in getting financial support from all of top 10 cities in CA as well as top 20 occupation. The negative finance is varied and depends on candidate name in difference location and occupation.

####Were there any interesting or surprising interactions between features?

I didnot see any suprising interactions between features because the number of contribution is the decisive factor to quantify those features of interest and the financial support is strongly related to this number.

##7. Final Plots and Summary

###Plot one
```{r echo = FALSE, warning=FALSE}
create_unibarplot(pfs_plus,'reorder(cand_nm,table(cand_nm)[cand_nm])') +
    theme(axis.text.x = element_text(angle = 90)) +
    ggtitle('Number of contribution per candidate') +
    coord_flip() +
    xlab('Name of candidate') + ylab('Number of contribution')

create_hisplot(pfs_plus,'contb_receipt_amt','yellow','black',0.05) +
    ggtitle('Money gain distribution') +
    xlab('Reported financial contribution') + ylab('count') +
    scale_x_log10()
summary(pfs_plus$contb_receipt_amt)
```

###Description one

The distribution of contribution per candidate is very skewed in California. The most favourite candidates are Hilary Clinton and Bernard Sanders with financial contribution > 400,000. Their contributions are 8 times larger than the rest. Additionally, it provides a good starting view to determine candidate's finance in this state. The amount of contribution is very diversed. Its range mainly from 15 to 96 usd.

###Plot two
```{r echo = FALSE, warning= FALSE, message= FALSE}
p1 <- create_bipointplot(by_cand_nm_p,'Count','Money', NA, 0.5) +
    theme(axis.text.x = element_text(angle = 90)) +
    xlab('Number of contribution') + ylab('Money Gain (usd)') +
    ggtitle("Money Support vs Number of contribution in CA") +
    geom_smooth(method = "lm") +
    xlim(0,60000) + ylim(0,10000000) #remove outliers

p2 <- create_bipointplot(by_cand_nm_m,'Count','Money', NA, 0.5) +
    theme(axis.text.x = element_text(angle = 90)) +
    xlab('Number of contribution') + ylab('Money Loss (usd)') +
    ggtitle("Money Loss vs Number of contribution in CA") +
    geom_smooth(method = "lm") +
    xlim(0,100) + ylim(-200000,0) #remove outliers

grid.arrange(p1,p2,ncol = 1)
```

###Description Two

This is the most important plot when I easily observe the trending of financial support and the number of contribution. Clearly, the increase of contribution is correlated to the increase and decrease of money support for candidate (r > 0.90). In the other words, candidate who has large group of contributors will have high chance to get large money support and also have high risk to lose a considerable money. This relationship can be described in linear regression model. In conclusion, if candidates want to enlarge their Election funding, they need to make their group of contributors larger. 

###Plot three
```{r echo = FALSE, warning= FALSE}
p1 <- ggplot(by_name_city, aes(x = city, y = Money, 
                               color = candidate_name)) +
    geom_point(size = 3) +
    coord_flip() +
    theme(axis.text.x = element_text(angle = 90)) +
    ggtitle("Total money gain vs top candidates vs top cities") +
    scale_color_discrete(name ="Candidate Name") +
    xlab("City") + ylab("Money Earn (usd)")

p2 <- ggplot(by_name_job, aes(x = occupation, y = Money, 
                              color = candidate_name)) +
    geom_point(size = 3) +
    coord_flip() +
    theme(axis.text.x = element_text(angle = 90)) +
    ggtitle("Total money gain vs top candidates vs top occupations") +
    scale_color_discrete(name ="Candidate Name") +
    xlab("Occupation") + ylab("Money Earn (usd)")
grid.arrange(p1,p2,ncol = 1)
```

###Description three

These two plots prove that there is no variables of interest that affect money support beside number of contribution. Large city has large money support. Large group of occupation has large money support. The financial contribution for each candidate varied depend on the number of contribution from each cities and each occupation. It stated that the location or the social status is not a factor for changing money support. The size is the main factor. On the other hand, the interesting point is that no labor group (retired or not employed) contributed more money than labor group in this election. Finally, the building of a preditive model is not a good approach for this dataset.

##8. Reflection

This financial contribution dataset contains information of more than 1 million observations across 19 variables in California from 2015 to 2016. In each individual variables, I started to select variable that helps me to answer my curiosity and leads to make observations on plots. At last, I explored the financial supports across the candidate, cities and occupation.

I encountered to the positive and negative number in financial report. If I didnot clean them, it would provide incorrect summary of financial support. Hence, I divided this dataset into two subset and did exploration. Moreover, I have categorical variables with more than 1000 factors. My solution is to limit those observations in top 5 candidates who have largest number of contributions in top 20 occupations and in top 10 cities.

There is a strong correlation between the number of contribution and the amount of money (both negative and positive side). There is no correlation between other categorical variables such as candidates, cities, occupations that I am interested. I struggled finding the relation between financial suports and other variables but this mystery is clearer when I realized that other variables are independent factors. So the relation is zero. In this exploration, I would like to provide the influence of candidates to cities and occupations by using the financial contribution. From that, we can estimate the chance of winner among those candidates during this American Election. Where is their strongest location ? Which people believe in their lead ? All those question can be answered by my plots.

However, my exploration has also limitations. Firstly, there is a duplication of money transactions from one unique contributor. Those contributors put money in and out of candidate funding by multiple times. Those activity makes outliers for the analysis and we get incorrect financial support for candidate per contributor. The good solution is making the financial summary of a unique contributor for every candidate. Because of lacking personal information (ex: date of birth, gender), I can not clean these errors correctly. Secondly, there is a group of unknow occupation. This is the intentional bias in which the contributors want to hide their info. This is one obstruction to clean this dataset. Thirdly, I only picked one state of America, it will underestimate the financial support of American Election. In further investigation, I prefer to use larger dataset including other states. Finally, I am not successful in making a predictive model based on categorical variables. That is the next thing I will do soon. The American Election 2016 was over so I hope to get a well-defined dataset.
